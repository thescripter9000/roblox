-- Trading Exploit Script
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Load required libraries
local Library = ReplicatedStorage:WaitForChild("Library")
local Types = require(Library.Items.Types)
local TradingCmds = require(Library.Client.TradingCmds)
local InventoryCmds = require(Library.Client.InventoryCmds)
local Functions = require(Library.Functions)

local LocalPlayer = Players.LocalPlayer

function getAllPetUIDsSilent()
    local allPets = {}
    
    -- Get the inventory container
    local container = InventoryCmds.Container()
    if not container then
        warn("No inventory container found")
        return allPets
    end
    
    -- Get all pets from inventory
    local pets = container:All(Types.Pet)
    
    for uid, pet in pairs(pets) do
        if pet then
            -- Safe directory access with error handling
            local success, petInfo = pcall(function()
                return pet:Directory()
            end)
            
            if success and petInfo and petInfo.name then
                allPets[petInfo.name] = uid
            else
                -- Try alternative method to get pet name
                local altNameSuccess, altName = pcall(function()
                    return pet:GetId() or "Unknown Pet"
                end)
                
                if altNameSuccess then
                    allPets[altName] = uid
                else
                    allPets["Unnamed_" .. uid] = uid
                end
            end
        end
    end
    
    return allPets
end

-- EXACT MATCH SEARCH - Only returns if name matches exactly
function getPetUIDByNameExact(petName)
    local allPets = getAllPetUIDsSilent()
    
    for name, uid in pairs(allPets) do
        if name == petName then  -- Exact match, case-sensitive
            print("Found exact pet:", name, "UID:", uid)
            return uid
        end
    end
    
    print("Pet not found with exact name:", petName)
    return nil
end

-- CASE-INSENSITIVE EXACT MATCH
function getPetUIDByNameExactIgnoreCase(petName)
    local allPets = getAllPetUIDsSilent()
    
    for name, uid in pairs(allPets) do
        if name:lower() == petName:lower() then  -- Exact match, case-insensitive
            print("Found exact pet (case-insensitive):", name, "UID:", uid)
            return uid
        end
    end
    
    print("Pet not found with exact name (case-insensitive):", petName)
    return nil
end

-- PARTIAL MATCH SEARCH
function getPetUIDByName(petName)
    local allPets = getAllPetUIDsSilent()
    
    for name, uid in pairs(allPets) do
        if name:lower():find(petName:lower()) then
            print("Found partial match pet:", name, "UID:", uid)
            return uid
        end
    end
    
    print("Pet not found with partial match:", petName)
    return nil
end

function tradePet(petName, targetPlayer)
    -- Verify target player exists
    local target = Players:FindFirstChild(targetPlayer)
    if not target then
        warn("Target player not found:", targetPlayer)
        return false
    end
    
    -- Get pet UID using EXACT match
    local petUID = getPetUIDByNameExact(petName)
    if not petUID then
        warn("Pet not found in inventory:", petName)
        return false
    end
    
    -- Safe pet retrieval
    local pet, petErr = pcall(function()
        return Types.Pet:Get(petUID)
    end)
    
    if not pet or not petErr then
        warn("Failed to retrieve pet:", petUID)
        return false
    end
    
    pet = petErr -- Get the actual pet object
    
    -- Check if we can trade the pet
    local canTrade, reason = TradingCmds.CanTrade(pet)
    if not canTrade then
        warn("Cannot trade pet:", reason)
        return false
    end
    
    -- Send trade request
    local success, errorMsg = TradingCmds.Request(target)
    if not success then
        warn("Trade request failed:", errorMsg)
        return false
    end
    
    print("Trade request sent to", targetPlayer)
    
    -- Wait for trade to be created
    wait(2)
    
    -- Add pet to trade
    local tradeSuccess, tradeError = TradingCmds.SetItem("Pet", petUID, 1)
    if not tradeSuccess then
        warn("Failed to add pet to trade:", tradeError)
        return false
    end
    
    print("Successfully added", petName, "to trade with", targetPlayer)
    return true
end

function listAllPets()
    print("=== ALL PETS IN INVENTORY ===")
    local allPets = getAllPetUIDsSilent()
    
    local count = 0
    for name, uid in pairs(allPets) do
        count = count + 1
        print(string.format("%d. %s - UID: %s", count, name, uid))
    end
    
    print(string.format("Total pets: %d", count))
    return allPets
end

-- Simple function to just get UID with EXACT matching
function simpleGetPetUIDExact(petName)
    local container = InventoryCmds.Container()
    if not container then return nil end
    
    local pets = container:All(Types.Pet)
    
    for uid, pet in pairs(pets) do
        if pet then
            -- Try multiple methods to get the name
            local name = nil
            
            -- Method 1: Directory
            local success1, dir = pcall(function() return pet:Directory() end)
            if success1 and dir and dir.name then
                name = dir.name
            end
            
            -- Method 2: GetId
            if not name then
                local success2, id = pcall(function() return pet:GetId() end)
                if success2 and id then
                    name = id
                end
            end
            
            -- Method 3: Class name
            if not name and pet.Class then
                name = tostring(pet.Class)
            end
            
            -- EXACT MATCH check
            if name and name == petName then
                print("Found exact pet:", name, "UID:", uid)
                return uid
            end
        end
    end
    
    print("Pet not found with exact name:", petName)
    return nil
end

-- Usage examples:
print("=== Pet Trading Exploit ===")

-- Method 1: Exact match search (CASE-SENSITIVE)
print("\n--- Exact Match Search (Case-Sensitive) ---")
local uid = getPetUIDByNameExact("Axolotl")
if uid then
    print("Found exact match Axolotl UID:", uid)
else
    print("No exact match found for 'Axolotl'")
end
